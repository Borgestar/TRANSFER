<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> AnotaÃ§Ãµes Transfer </title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 10px; max-width: 600px; margin: auto; padding-bottom: 80px; color: #333; }
        
        /* PLACAR */
        .placar { background: #fff; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .saldo { font-size: 32px; font-weight: 800; color: #2c3e50; }
        .resumo { display: flex; justify-content: center; gap: 20px; font-size: 14px; margin-top: 10px; color: #666; }
        .tag-lucro { background: #e8f5e9; color: #2e7d32; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .tag-gasto { background: #ffebee; color: #c62828; padding: 2px 8px; border-radius: 4px; font-weight: bold; }

        /* INPUTS */
        .input-area { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        label { display: block; font-size: 12px; color: #7f8c8d; margin-bottom: 4px; font-weight: 600; }
        input { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: #3498db; }
        
        .botoes { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 14px; cursor: pointer; color: white; transition: 0.2s; text-transform: uppercase; letter-spacing: 0.5px; }
        button:active { transform: scale(0.98); }
        .btn-green { background: #27ae60; box-shadow: 0 4px 0 #219150; }
        .btn-red { background: #c0392b; box-shadow: 0 4px 0 #a93226; }

        /* TABELA */
        h3 { font-size: 16px; color: #7f8c8d; text-transform: uppercase; margin-bottom: 10px; border-bottom: 2px solid #ddd; padding-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        th { background: #34495e; color: #fff; padding: 12px; text-align: left; font-size: 12px; }
        td { padding: 15px; border-bottom: 1px solid #f0f0f0; font-size: 14px; vertical-align: middle; }
        .val-pos { color: #27ae60; font-weight: bold; }
        .val-neg { color: #c0392b; font-weight: bold; }
        .btn-apagar { background: #ecf0f1; color: #95a5a6; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* SEGURANÃ‡A E RODAPÃ‰ */
        .backup-area { text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
        .btn-backup, .btn-restore { background: #3498db; color: white; padding: 8px 15px; font-size: 12px; border-radius: 6px; margin: 5px; box-shadow: none; width: auto; text-transform: none; }
        .btn-restore { background: #95a5a6; }

        footer { text-align: center; margin-top: 40px; padding: 20px; background: #2c3e50; color: #ecf0f1; border-radius: 12px; font-size: 13px; }
        footer strong { color: #f1c40f; }
        footer a { color: #ecf0f1; text-decoration: none; display: block; margin-top: 5px; font-weight: bold; font-size: 15px; }

        #fileInput { display: none; }
    </style>
</head>
<body>

    <div class="placar">
        <div id="saldo-total" class="saldo">R$ 0,00</div>
        <div class="resumo">
            <span class="tag-lucro">Entrou: <span id="tot-ent">0</span></span>
            <span class="tag-gasto">Saiu: <span id="tot-sai">0</span></span>
        </div>
        <div style="font-size: 12px; color: #999; margin-top: 10px; font-weight: 500;">
            Custo MÃ©dio: <span id="custo-km" style="color:#333">R$ 0,00</span> / km
        </div>
    </div>

    <div class="input-area">
        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Data</label>
                <input type="date" id="data">
            </div>
            <div style="flex: 1;">
                <label>KM (Opcional)</label>
                <input type="number" id="km" placeholder="0">
            </div>
        </div>

        <label>DescriÃ§Ã£o</label>
        <input type="text" id="desc" placeholder="Ex: GIG x BÃºzios ou Gasolina">

        <label>Valor (R$)</label>
        <input type="number" id="valor" placeholder="0,00" inputmode="decimal" step="0.01">

        <div class="botoes">
            <button class="btn-green" onclick="lancar('entrada')">Recebi (+)</button>
            <button class="btn-red" onclick="lancar('saida')">Gastei (-)</button>
        </div>
    </div>

    <h3>Extrato de Viagens</h3>
    <table>
        <thead>
            <tr>
                <th width="20%">Data</th>
                <th>DescriÃ§Ã£o</th>
                <th width="25%">Valor</th>
                <th width="10%"></th>
            </tr>
        </thead>
        <tbody id="tabela-corpo"></tbody>
    </table>

    <div class="backup-area">
        <p style="font-size: 11px; color: #999; margin-bottom: 10px;">SEGURANÃ‡A DOS DADOS</p>
        <button class="btn-backup" onclick="baixarBackup()">ðŸ’¾ Baixar CÃ³pia</button>
        <button class="btn-restore" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Restaurar</button>
        <input type="file" id="fileInput" onchange="restaurarBackup(this)">
    </div>

    <footer>
        Sistema desenvolvido e operado por<br>
        <strong>LUCAS BORGES</strong>
        
        <a href="tel:552179779313">ðŸ“ž (21) 97977-9313</a>
    </footer>

    <script>
        // --- INICIALIZAÃ‡ÃƒO ---
        document.getElementById('data').valueAsDate = new Date();
        let lista = JSON.parse(localStorage.getItem('caderno_lucas')) || []; // Mudei o nome do banco pra ficar exclusivo
        atualizarTabela();

        // --- LANÃ‡AMENTO ---
        function lancar(tipo) {
            let data = document.getElementById('data').value;
            let desc = document.getElementById('desc').value;
            let valor = parseFloat(document.getElementById('valor').value);
            let km = parseFloat(document.getElementById('km').value) || 0;

            if (!desc || !valor) {
                alert("Preenche a descriÃ§Ã£o e o valor, meu parceiro!");
                return;
            }

            lista.unshift({
                id: Date.now(),
                data: data,
                desc: desc,
                valor: valor,
                tipo: tipo,
                km: km
            });

            salvar();
            
            document.getElementById('desc').value = '';
            document.getElementById('valor').value = '';
            document.getElementById('km').value = '';
            document.getElementById('desc').focus();
        }

        // --- ATUALIZAÃ‡ÃƒO VISUAL ---
        function atualizarTabela() {
            let corpo = document.getElementById('tabela-corpo');
            corpo.innerHTML = '';

            let total = 0, entrou = 0, saiu = 0, totalKm = 0;

            lista.forEach(item => {
                if (item.tipo === 'entrada') {
                    total += item.valor;
                    entrou += item.valor;
                    totalKm += item.km;
                } else {
                    total -= item.valor;
                    saiu += item.valor;
                }

                let dataFormatada = item.data.split('-').reverse().slice(0,2).join('/');
                let corValor = item.tipo === 'entrada' ? 'val-pos' : 'val-neg';
                let sinal = item.tipo === 'entrada' ? '' : '-';

                corpo.innerHTML += `
                    <tr>
                        <td><span style="background:#eee; padding:3px 6px; border-radius:4px; font-size:12px; font-weight:bold; color:#555">${dataFormatada}</span></td>
                        <td>
                            <strong>${item.desc}</strong>
                            ${item.km ? `<br><small style='color:#7f8c8d'>ðŸš¦ ${item.km} km</small>` : ''}
                        </td>
                        <td class="${corValor}">${sinal}R$ ${item.valor.toFixed(2)}</td>
                        <td><button class="btn-apagar" onclick="apagar(${item.id})">x</button></td>
                    </tr>
                `;
            });

            document.getElementById('saldo-total').innerText = 'R$ ' + total.toFixed(2);
            document.getElementById('tot-ent').innerText = entrou.toFixed(2);
            document.getElementById('tot-sai').innerText = saiu.toFixed(2);

            let custo = totalKm > 0 ? (saiu / totalKm) : 0;
            document.getElementById('custo-km').innerText = 'R$ ' + custo.toFixed(2);
        }

        // --- SALVAR ---
        function salvar() {
            localStorage.setItem('caderno_lucas', JSON.stringify(lista));
            atualizarTabela();
        }

        function apagar(id) {
            if(confirm("Apagar este registro?")) {
                lista = lista.filter(item => item.id !== id);
                salvar();
            }
        }

        // --- BACKUP ---
        function baixarBackup() {
            if (lista.length === 0) return alert("Nada para salvar ainda!");
            const dadosStr = JSON.stringify(lista);
            const blob = new Blob([dadosStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "backup_lucas_" + new Date().toISOString().slice(0,10) + ".json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function restaurarBackup(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dadosCarregados = JSON.parse(e.target.result);
                    if (Array.isArray(dadosCarregados)) {
                        if(confirm("Substituir lista atual pela cÃ³pia de seguranÃ§a?")) {
                            lista = dadosCarregados;
                            salvar();
                            alert("Dados restaurados com sucesso!");
                        }
                    }
                } catch (erro) { alert("Arquivo invÃ¡lido."); }
            };
            reader.readAsText(file);
            input.value = '';
        }
    </script>
</body>
</html>