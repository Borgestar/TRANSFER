<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gest√£o transfer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- ESTILOS GERAIS --- */
        :root { --primary: #2962ff; --bg: #f2f4f7; --text: #1a1a1a; --green: #00c853; --red: #d50000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; height: 100vh; overflow: hidden; }

        /* HEADER */
        .app-header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .user h1 { margin: 0; font-size: 18px; font-weight: 800; color: #333; }
        .user p { margin: 0; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        /* NAVEGADOR DE M√äS (NOVIDADE) */
        .month-nav { display: flex; align-items: center; justify-content: space-between; background: white; margin: 15px 0; padding: 10px 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .btn-month { background: none; border: none; font-size: 18px; color: var(--primary); padding: 10px; cursor: pointer; }
        .current-month { font-weight: 800; text-transform: uppercase; color: #333; font-size: 14px; }

        /* PAGE SYSTEM */
        .page { display: none; height: 100%; overflow-y: auto; padding: 15px; padding-bottom: 120px; } /* Padding maior embaixo pra n√£o cortar conte√∫do */
        .page.active { display: block; animation: fadeIn 0.3s; }

        /* CARD SALDO */
        .card-main { background: linear-gradient(135deg, #2962ff 0%, #1565c0 100%); color: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 20px rgba(41,98,255,0.25); margin-bottom: 25px; text-align: center; position: relative; overflow: hidden; }
        .card-main::after { content:''; position: absolute; top:-50%; right:-50%; width:200%; height:200%; background: radial-gradient(circle, rgba(255,255,255,0.1), transparent); }
        .val-saldo { font-size: 38px; font-weight: 700; margin: 10px 0; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .stats-row { display: flex; justify-content: center; gap: 15px; font-size: 13px; background: rgba(0,0,0,0.15); padding: 8px; border-radius: 10px; margin-top: 10px; }

        /* BOT√ïES DE A√á√ÉO */
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .btn-big { background: white; border: none; padding: 15px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; gap: 8px; font-weight: 600; color: #444; box-shadow: 0 4px 10px rgba(0,0,0,0.03); cursor: pointer; transition: 0.1s; }
        .btn-big:active { transform: scale(0.98); }
        .btn-big i { font-size: 20px; padding: 12px; border-radius: 50%; }
        .ico-up { background: #e8f5e9; color: var(--green); }
        .ico-down { background: #ffebee; color: var(--red); }

        /* LISTA DI√ÅRIA */
        .day-group { background: white; border-radius: 16px; overflow: hidden; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .day-header { background: #f8f9fa; padding: 12px 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .day-date { font-weight: 700; font-size: 14px; color: #333; }
        .day-total { font-weight: 700; font-size: 13px; }
        
        .txn-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f5f5f5; position: relative; }
        .txn-bar { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        .txn-desc { font-weight: 600; font-size: 15px; display: block; color: #333; }
        .txn-sub { font-size: 12px; color: #999; margin-top: 3px; }
        .txn-val { font-weight: 700; font-size: 15px; }
        .btn-del { background: none; border: none; color: #ddd; padding: 5px 10px; font-size: 18px; }

        /* NAVEGA√á√ÉO BOTTOM */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 90; }
        .nav-item { background: none; border: none; color: #ccc; display: flex; flex-direction: column; align-items: center; font-size: 10px; gap: 4px; font-weight: 500; }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        .nav-item i { font-size: 20px; }

        /* RODAP√â */
        .footer-brand { text-align: center; margin-top: 30px; padding: 20px; background: #222; color: #666; border-radius: 16px; font-size: 12px; }
        .footer-brand strong { color: white; font-size: 14px; display: block; margin-bottom: 5px; }
        .footer-link { color: #2962ff; text-decoration: none; font-weight: bold; font-size: 14px; display: block; margin-top: 10px; }
        
        .tools-card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; text-align: center; }
        .btn-tool { width: 100%; background: #f5f5f5; border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-bottom: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px; color: #555; }

        /* MODAL */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 100; align-items: flex-end; }
        .modal.open { display: flex; animation: slideUp 0.3s; }
        .modal-content { background: white; width: 100%; padding: 25px; border-radius: 25px 25px 0 0; }
        input { width: 100%; padding: 16px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 12px; background: #f9f9f9; font-size: 16px; }
        .btn-confirm { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; color: white; font-size: 16px; margin-top: 10px; }

        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        @keyframes slideUp { from {transform: translateY(100%)} to {transform: translateY(0)} }
        #fileInput { display: none; }
    </style>
</head>
<body>

    <div id="pg-home" class="page active">
        <div class="app-header">
            <div class="user">
                <p></p>
                <h1>Gest√£o transfer</h1>
            </div>
            <i class="fas fa-taxi" style="color:var(--primary); font-size:24px"></i>
        </div>

        <div class="month-nav">
            <button class="btn-month" onclick="mudarMes(-1)"><i class="fas fa-chevron-left"></i></button>
            <span id="display-mes" class="current-month">JANEIRO 2026</span>
            <button class="btn-month" onclick="mudarMes(1)"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div class="card-main">
            <div style="font-size: 11px; opacity: 0.8; letter-spacing: 1px;">LUCRO DO M√äS</div>
            <div class="val-saldo">R$ <span id="dash-saldo">0,00</span></div>
            <div class="stats-row">
                <span>Entrou: <b id="dash-ent" style="color:#a5d6a7">0</b></span>
                <span style="border-left:1px solid rgba(255,255,255,0.3); margin:0 5px"></span>
                <span>Saiu: <b id="dash-sai" style="color:#ef9a9a">0</b></span>
            </div>
        </div>

        <div class="actions-grid">
            <button class="btn-big" onclick="abrirModal('entrada')">
                <i class="fas fa-arrow-up ico-up"></i>
                <span>Receita</span>
            </button>
            <button class="btn-big" onclick="abrirModal('saida')">
                <i class="fas fa-arrow-down ico-down"></i>
                <span>Despesa</span>
            </button>
        </div>

        <div style="font-weight:bold; color:#666; margin-bottom:10px; font-size:14px">Movimenta√ß√£o do M√™s</div>
        <div id="lista-home"></div>
    </div>

    <div id="pg-extrato" class="page">
        <div class="app-header">
            <h1>Extrato (M√™s Atual)</h1>
        </div>
        <div id="lista-full" style="padding-top:15px"></div>
    </div>

    <div id="pg-perfil" class="page">
        <div class="app-header">
            <h1>Sistema</h1>
        </div>
        
        <div class="tools-card">
            <h3>Backup Geral</h3>
            <p style="font-size:12px; color:#666; margin-bottom:20px">Isso salva o hist√≥rico de <b>todos os meses</b>.</p>
            <button class="btn-tool" onclick="baixarBackup()"><i class="fas fa-cloud-download-alt"></i> Baixar C√≥pia</button>
            <button class="btn-tool" onclick="document.getElementById('fileInput').click()"><i class="fas fa-sync-alt"></i> Restaurar</button>
            <input type="file" id="fileInput" onchange="restaurarBackup(this)">
        </div>

        <footer class="footer-brand">
            Desenvolvido por<br><strong>LUCAS BORGES</strong>
            <div style="border-top:1px solid #444; margin:15px 0"></div>
            <a href="tel:5521979779313" class="footer-link">üìû (21) 979779313</a>
            <div style="margin-top:10px; font-size:10px">Vers√£o 10.0 Mensal</div>
        </footer>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="nav('home', this)">
            <i class="fas fa-home"></i> In√≠cio
        </button>
        <button class="nav-item" onclick="nav('extrato', this)">
            <i class="fas fa-file-invoice-dollar"></i> Extrato
        </button>
        <button class="nav-item" onclick="nav('perfil', this)">
            <i class="fas fa-cog"></i> Sistema
        </button>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-tit" style="margin-top:0">Novo</h2>
            <input type="date" id="m-data">
            <input type="text" id="m-desc" placeholder="Descri√ß√£o">
            <div style="display:flex; gap:10px">
                <input type="number" id="m-val" placeholder="R$" step="0.01" style="flex:1">
                <input type="number" id="m-km" placeholder="KM" step="0.1" style="flex:1">
            </div>
            <input type="hidden" id="m-tipo">
            <button id="btn-save" class="btn-confirm" onclick="salvar()">Confirmar</button>
            <button onclick="document.getElementById('modal').classList.remove('open')" class="btn-confirm" style="background:#f0f0f0; color:#333; margin-top:5px">Cancelar</button>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO DE DATA MENSAL ---
        let dataNavegacao = new Date(); // Come√ßa hoje
        let db = JSON.parse(localStorage.getItem('app_lucas_final')) || [];

        // Iniciar
        document.getElementById('m-data').valueAsDate = new Date();
        render();

        // --- NAVEGA√á√ÉO DE M√äS ---
        function mudarMes(direcao) {
            // Muda o m√™s da data de controle
            dataNavegacao.setMonth(dataNavegacao.getMonth() + direcao);
            render();
        }

        // --- RENDERIZA√á√ÉO INTELIGENTE (FILTRA POR M√äS) ---
        function render() {
            // 1. Descobrir qual m√™s estamos vendo (YYYY-MM)
            let ano = dataNavegacao.getFullYear();
            let mes = dataNavegacao.getMonth(); // 0 a 11
            let filtroMes = `${ano}-${String(mes+1).padStart(2, '0')}`;

            // 2. Atualizar T√≠tulo do M√™s na tela
            let nomeMes = dataNavegacao.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            document.getElementById('display-mes').innerText = nomeMes.toUpperCase();

            // 3. Filtrar o banco de dados S√ì para esse m√™s
            let itensDoMes = db.filter(item => item.data.startsWith(filtroMes));

            // 4. Calcular Saldo do M√™s (S√≥ dos itens filtrados)
            let tot = 0, ent = 0, sai = 0;
            itensDoMes.forEach(i => { if(i.tipo==='entrada'){ tot+=i.val; ent+=i.val } else { tot-=i.val; sai+=i.val } });

            document.getElementById('dash-saldo').innerText = tot.toFixed(2);
            document.getElementById('dash-ent').innerText = ent.toFixed(2);
            document.getElementById('dash-sai').innerText = sai.toFixed(2);

            // 5. Agrupar por Dias (S√≥ dos itens filtrados)
            let grupos = {};
            itensDoMes.forEach(i => {
                if(!grupos[i.data]) grupos[i.data] = [];
                grupos[i.data].push(i);
            });
            let datas = Object.keys(grupos).sort().reverse();

            // 6. Gerar HTML
            let html = '';
            datas.forEach(data => {
                let itens = grupos[data];
                let saldoDia = 0, kmDia = 0;
                let linhas = '';

                itens.forEach(i => {
                    if(i.tipo==='entrada') { saldoDia += i.val; kmDia += i.km } else { saldoDia -= i.val; }
                    let cor = i.tipo==='entrada' ? 'var(--green)' : 'var(--red)';
                    let sinal = i.tipo==='entrada' ? '+' : '-';
                    linhas += `
                    <div class="txn-item">
                        <div class="txn-bar" style="background:${cor}"></div>
                        <div style="flex:1">
                            <span class="txn-desc">${i.desc}</span>
                            <span class="txn-sub">${i.km ? 'üö¶ '+i.km+' km' : 'Geral'}</span>
                        </div>
                        <div style="text-align:right">
                            <span class="txn-val" style="color:${cor}">${sinal}${i.val.toFixed(2)}</span>
                            <button class="btn-del" onclick="apagar(${i.id})">&times;</button>
                        </div>
                    </div>`;
                });

                let [Y, M, D] = data.split('-');
                let diaSemana = new Date(Y, M-1, D).toLocaleDateString('pt-BR', {weekday:'long'});
                let corDia = saldoDia >= 0 ? 'var(--green)' : 'var(--red)';

                html += `
                <div class="day-group">
                    <div class="day-header">
                        <div><span class="day-date">${D}/${M}</span> <span style="font-size:12px; color:#999; text-transform:capitalize">‚Ä¢ ${diaSemana}</span></div>
                        <div style="text-align:right">
                            <span class="day-total" style="color:${corDia}">R$ ${saldoDia.toFixed(2)}</span>
                            <div style="font-size:10px; color:#999">${kmDia.toFixed(1)} km</div>
                        </div>
                    </div>
                    ${linhas}
                </div>`;
            });

            let vazio = '<div style="text-align:center; padding:30px; color:#aaa">Sem lan√ßamentos neste m√™s.</div>';
            document.getElementById('lista-home').innerHTML = html || vazio;
            document.getElementById('lista-full').innerHTML = html || vazio;
        }

        // --- FUN√á√ïES PADR√ÉO ---
        function nav(pag, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('pg-'+pag).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
        }

        function abrirModal(tipo) {
            document.getElementById('modal').classList.add('open');
            document.getElementById('m-tipo').value = tipo;
            let btn = document.getElementById('btn-save');
            if(tipo === 'entrada') {
                document.getElementById('modal-tit').innerText = 'Nova Receita';
                btn.style.background = 'var(--green)';
            } else {
                document.getElementById('modal-tit').innerText = 'Nova Despesa';
                btn.style.background = 'var(--red)';
            }
        }

        function salvar() {
            let desc = document.getElementById('m-desc').value;
            let val = parseFloat(document.getElementById('m-val').value);
            let km = parseFloat(document.getElementById('m-km').value) || 0;
            if(!desc || !val) return alert('Preencha os dados!');

            db.unshift({
                id: Date.now(),
                data: document.getElementById('m-data').value,
                desc, val, km,
                tipo: document.getElementById('m-tipo').value
            });
            localStorage.setItem('app_lucas_final', JSON.stringify(db));
            
            document.getElementById('modal').classList.remove('open');
            document.getElementById('m-desc').value = ''; 
            document.getElementById('m-val').value = '';
            document.getElementById('m-km').value = '';
            
            // Se o usu√°rio adicionou data de outro m√™s, muda a visualiza√ß√£o para l√°
            let dataLanc = new Date(document.getElementById('m-data').value + 'T00:00');
            dataNavegacao = dataLanc; 
            
            render();
        }

        function apagar(id) {
            if(confirm('Apagar registro?')) {
                db = db.filter(i => i.id !== id);
                localStorage.setItem('app_lucas_final', JSON.stringify(db));
                render();
            }
        }

        function baixarBackup() {
            let blob = new Blob([JSON.stringify(db)], {type: "application/json"});
            let url = URL.createObjectURL(blob);
            let a = document.createElement('a'); a.href = url; a.download = "backup_lucas_geral.json";
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }

        function restaurarBackup(input) {
            let file = input.files[0];
            if(!file) return;
            let reader = new FileReader();
            reader.onload = function(e) {
                try {
                    db = JSON.parse(e.target.result);
                    localStorage.setItem('app_lucas_final', JSON.stringify(db));
                    render();
                    alert('Dados restaurados!');
                } catch(e) { alert('Erro no arquivo'); }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>